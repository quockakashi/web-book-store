<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>
    Login - HCMUS Book Store System
  </title>
  <script src="https://kit.fontawesome.com/0f8c4fe9ac.js" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
  <link href="/css/general.css" rel="stylesheet" type="text/css">
</head>

<body>
  <div class="container-fluid d-flex w-100 d-flex justify-content-center align-items-center h-100 position-relative">
        <div class="alert alert-danger d-flex align-items-center position-absolute align-items-center"
        style="top: 25px; right: 36px; opacity: 0" role="alert">
            <i class="fa-solid fa-triangle-exclamation"></i>
            &nbsp;
            <p class="alert-message" style="margin: 0;"></p>
        <div>
    </div>
    </div>
    <form class="py-4 px-4 rounded-3 shadow-lg" style="width: 400px;" onsubmit="return handleSubmit(event)">
        <h3 class="mb-2">Welcome back</h3>
        <a class="link-primary text-decoration-none">Don't have an account</a>
        <div class="mt-4 mb-3">
          <label for="email" class="form-label">Email address</label>
          <input required type="email" class="form-control" id="email" aria-describedby="emailHelp">
        </div>
        <div class="mb-3 position-relative">
          <label for="password" class="form-label">Password</label>
          <div class="input-group">
            <input required type="password" class="form-control" id="password"
            style="border-right: none;">
          <button
          id="show-pw-btn"
          style="background-color: inherit; border-left: none;" 
          type="button"
          class="input-group-text text-primary"><i class="fa-regular fa-eye show-pw-icon"></i></button>
          </div>
        </div>
        <div class="mb-3 form-check">
          <input checked type="checkbox" class="form-check-input" id="rememberMe">
          <label class="form-check-label" for="rememberMe">Remember Me</label>
        </div>
        <a class="link-primary
         text-decoration-none" style="font-size: 14px;">Forgot your password?</a>
        <button type="submit" class="btn btn-primary w-100 mt-2">Login</button>
      </form>
  </div>
</body>
<script>
    $(document).ready(() => {
        let showPw = false;
        $('#show-pw-btn').on('click', (e) => {
            if(!showPw) {
                $("#password").attr('type', 'text');
                $('.show-pw-icon').removeClass('fa-eye');
                $('.show-pw-icon').addClass('fa-eye-slash');
                showPw = true;
            } else {
                $("#password").attr('type', 'password');
                $('.show-pw-icon').removeClass('fa-eye-slash');
                $('.show-pw-icon').addClass('fa-eye');
                showPw = false;
            }
        })
    });
    
    const handleSubmit = async (e) => {
        e.preventDefault();
        const email = $('#email').val();
        const password = $('#password').val();
        const rememberMe = $('#rememberMe').prop('checked');
        //console.log(email, password, rememberMe);

        try {
            const res = await fetch('/api/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({email, password, rememberMe})
            });
            if(res.ok) {
                window.location.href = '/'
            } else {
                console.log('Authenticate failed')
                $('.alert-message').html('Invalid Credential!');
                $('.alert').css({
                    'opacity': '1',
                })
            }
        } catch(err) {
            console.log(err);
        }

        return false;
    };
</script>
</html>